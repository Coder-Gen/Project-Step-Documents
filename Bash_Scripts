#!/bin/bash

# === CONFIGURATION ===
NAMESPACE="default"                          # Change if needed
SERVICE_NAME="clusterpulse-svc"                  # service name in cluster
LOCAL_PORT=8080                              # Port on local machine
REMOTE_PORT=80                               # Port exposed by the service
LOG_FILE="/tmp/port-forward.log"             # Optional log file

# === LOOP FOREVER ===
echo "Starting persistent port-forward loop for $SERVICE_NAME ($LOCAL_PORT â†’ $REMOTE_PORT)..."

while true; do
  echo "$(date)  Attempting port-forward..." >> "$LOG_FILE"
  
  # Run port-forward silently in background
  kubectl port-forward svc/"$SERVICE_NAME" "$LOCAL_PORT":"$REMOTE_PORT" -n "$NAMESPACE" >> "$LOG_FILE" 2>&1
  
  echo "$(date)  Port-forward stopped. Retrying in 5 seconds..." >> "$LOG_FILE"
  sleep 5
done
